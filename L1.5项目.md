项目

根目录安装依赖 pnpm i  

启代码：

`cd editor-view`	

​	`npm run dev`

Build:

`npm run build`

如果构建不了删除以下文件：

`packages/editor-model/tsconfig.tsbuildinfo`

代码看的部分：

```
//packages/editor-view/src/plugin/react-editor.ts
toSlateRange

改domRange

//editable.tsc

//packages/editor-view/src/utils/dom.ts
isDOMSelection

ReactEditor
```

找selection源头：

```

1.editable组件的selection从editor中获取
	domSelection 浏览器对应的selection
2.editor的创建
editor = useMemo(() => (withReact(createEditor())), [])
3.找到createEditor
//packages/editor-model/src/create-editor.ts
createEditor 
最先，定义selection为null

从op中获得大概
```



getSelection 所用位置:

//packages/editor-view/src/plugin/react-editor.ts

```
deselect(editor: ReactEditor):
	const domSelection = root.getSelection()
	
	
findDocumentOrShadowRoot()
	root.getSelection

```

//packages/editor-view/src/components/editable.tsx

```
useIsomorphicLayoutEffect()
170:
 const domSelection = root.getSelection()
 
onDOMSelectionChange
323
	const domSelection = root.getSelection()
      
      353
      //给editor 的range设置从浏览器获取的selection
      const { anchorNode, focusNode } = domSelection

	
onblur
789:
	if (IS_SAFARI) {
            const domSelection = root.getSelection()
            domSelection?.removeAllRanges()
```

op是什么

点击获取的selection

```
anchorNode: text
anchorOffset: 16
baseNode: text
baseOffset: 16
extentNode: text
extentOffset: 16
focusNode: text
focusOffset: 16
isCollapsed: true
rangeCount: 1
type: "Caret"
[[Prototype]]: Selection
```

滑动 选区获取的selection

```
anchorNode: text
anchorOffset: 21
baseNode: text
baseOffset: 21
extentNode: text
extentOffset: 15
focusNode: text
focusOffset: 15
isCollapsed: false
rangeCount: 1
type: "Range"
[[Prototype]]: Selection
```



自己的range:

```
collapsed: false
commonAncestorContainer: text
endContainer: text
endOffset: 66
startContainer: text
startOffset: 57
[[Prototype]]: Range
END_TO_END: 2
END_TO_START: 3
START_TO_END: 1
START_TO_START: 0
cloneContents: ƒ cloneContents()
cloneRange: ƒ cloneRange()
collapse: ƒ collapse()
commonAncestorContainer: (...)
compareBoundaryPoints: ƒ compareBoundaryPoints()
comparePoint: ƒ comparePoint()
createContextualFragment: ƒ createContextualFragment()
deleteContents: ƒ deleteContents()
detach: ƒ detach()
expand: ƒ expand()
extractContents: ƒ extractContents()
getBoundingClientRect: ƒ getBoundingClientRect()
getClientRects: ƒ getClientRects()
insertNode: ƒ insertNode()
intersectsNode: ƒ intersectsNode()
isPointInRange: ƒ isPointInRange()
selectNode: ƒ selectNode()
selectNodeContents: ƒ selectNodeContents()
setEnd: ƒ setEnd()
setEndAfter: ƒ setEndAfter()
setEndBefore: ƒ setEndBefore()
setStart: ƒ setStart()
setStartAfter: ƒ setStartAfter()
setStartBefore: ƒ setStartBefore()
surroundContents: ƒ surroundContents()
toString: ƒ toString()
constructor: ƒ Range()
Symbol(Symbol.toStringTag): "Range"
collapsed: (...)
endContainer: (...)
endOffset: (...)
startContainer: (...)
startOffset: (...)
get commonAncestorContainer: ƒ commonAncestorContainer()
[[Prototype]]: AbstractRange
```

自己的光标range：

```
collapsed: true
commonAncestorContainer: text
endContainer: text
endOffset: 68
startContainer: text
startOffset: 68
[[Prototype]]: Range
END_TO_END: 2
END_TO_START: 3
START_TO_END: 1
START_TO_START: 0
cloneContents: ƒ cloneContents()
cloneRange: ƒ cloneRange()
collapse: ƒ collapse()
commonAncestorContainer: (...)
compareBoundaryPoints: ƒ compareBoundaryPoints()
comparePoint: ƒ comparePoint()
createContextualFragment: ƒ createContextualFragment()
deleteContents: ƒ deleteContents()
detach: ƒ detach()
expand: ƒ expand()
extractContents: ƒ extractContents()
getBoundingClientRect: ƒ getBoundingClientRect()
getClientRects: ƒ getClientRects()
insertNode: ƒ insertNode()
intersectsNode: ƒ intersectsNode()
isPointInRange: ƒ isPointInRange()
selectNode: ƒ selectNode()
selectNodeContents: ƒ selectNodeContents()
setEnd: ƒ setEnd()
setEndAfter: ƒ setEndAfter()
setEndBefore: ƒ setEndBefore()
setStart: ƒ setStart()
setStartAfter: ƒ setStartAfter()
setStartBefore: ƒ setStartBefore()
surroundContents: ƒ surroundContents()
toString: ƒ toString()
constructor: ƒ Range()
Symbol(Symbol.toStringTag): "Range"
collapsed: (...)
endContainer: (...)
endOffset: (...)
startContainer: (...)
startOffset: (...)
get commonAncestorContainer: ƒ commonAncestorContainer()
[[Prototype]]: AbstractRange
```







